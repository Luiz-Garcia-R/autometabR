% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/MetabolDiff.R
\name{metabol.diff}
\alias{metabol.diff}
\title{Differential Analysis for Metabolomics Data Using Limma}
\usage{
metabol.diff(
  normalized_data,
  metadata = NULL,
  group_col = "Group",
  contrast = NULL,
  verbose = TRUE,
  assign_result = TRUE,
  assign_name = NULL,
  envir = parent.frame()
)
}
\arguments{
\item{normalized_data}{A \code{metabolNorm} object generated by
\code{metabol.normalize()}. Must contain at least \code{expr_matrix}, and optionally
\code{metadata} and prior \code{limma_results}.}

\item{metadata}{Optional data frame containing sample metadata, including a
\code{"Sample"} column and a grouping column. If omitted, the function will use
\code{normalized_data$metadata} when available.}

\item{group_col}{Name of the column in metadata representing group labels.
Default is \code{"Group"}.}

\item{contrast}{A character string specifying a contrast in the
\code{limma::makeContrasts()} format (e.g., \code{"Treated - Control"}). If \code{NULL}
and two groups exist, the contrast is generated automatically.}

\item{verbose}{Logical; whether to print informative messages during the run.
Default is \code{TRUE}.}

\item{assign_result}{Logical; whether to assign the updated object (with
\code{limma_results}) back to the caller environment. Default is \code{TRUE}.}

\item{assign_name}{Optional custom name to assign the object to. If \code{NULL},
the function attempts to infer the name of the input object.}

\item{envir}{Environment where the updated object will be assigned.
Default is the parent frame.}
}
\value{
If \code{assign_result = TRUE}, returns \code{invisible(NULL)} and assigns the modified
object back to the calling environment.
If \code{assign_result = FALSE}, returns the updated \code{normalized_data} object
containing:

\itemize{
\item \verb{$limma_results$results} – data frame with \code{logFC}, \code{P.Value},
\code{adj.P.Val}, \code{t}, etc.
\item \verb{$limma_results$design} – design matrix used in the analysis.
\item \verb{$limma_results$contrast} – contrast string.
\item \verb{$limma_results$fit} – fitted \code{eBayes} model object.
\item \verb{$limma_results$metadata} – metadata matched to expression samples.
\item \verb{$limma_results$expr_used} – expression matrix used internally.
}
}
\description{
Performs differential analysis between experimental groups using the
\code{limma} workflow. The function extracts expression data from a
\code{metabolNorm} object, merges with metadata, builds a design matrix,
constructs a contrast, and returns (or auto-assigns) a \code{limma} results list
containing statistics for all metabolites.
}
\details{
This function is designed to work with objects produced by
\code{metabol.normalize()}, which store normalized intensities in
\code{normalized_data$expr_matrix} and optionally metadata in
\code{normalized_data$metadata}.

If \code{metadata} is not provided explicitly, the function attempts to retrieve
it from the normalized object. Metadata must contain a \code{"Sample"} column and
a grouping column specified via \code{group_col}.

The design matrix is constructed using one-hot encoding (\code{~ 0 + group}),
where groups are taken from \code{metadata[[group_col]]}. If no \code{contrast} is
specified and exactly two groups are present, the contrast is automatically
defined as \code{"Group2 - Group1"}. For more than two groups, a manual contrast
is required.

By default, the updated \code{normalized_data} object (now containing
\verb{$limma_results}) is auto-assigned back to the calling environment, mimicking
the behavior of workflows in packages like \strong{limma} and \strong{edgeR}.
}
\examples{
\dontrun{
# Basic usage with two groups
metabol.diff(my_norm)

# Explicit metadata and contrast
metabol.diff(
  normalized_data = my_norm,
  metadata = meta_df,
  group_col = "Condition",
  contrast = "Infected - Control"
)

# Disable auto-assign and capture the output
res <- metabol.diff(my_norm, assign_result = FALSE)
}

}
